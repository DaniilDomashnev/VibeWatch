<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VibeWatch - Lobby</title>
    <link rel="stylesheet" href="style.css">
</head>

<body class="center-screen">
    <div class="card" style="text-align: center;">
        <h2 style="margin-bottom: 10px;">VibeWatch Lobby</h2>
        <p id="user-display" style="color: var(--text-muted); margin-bottom: 20px;"></p>

        <button id="create-btn" class="btn btn-primary" style="width: 100%; margin-bottom: 20px;">Create New
            Room</button>

        <div style="border-top: 1px solid var(--border); padding-top: 20px;">
            <p style="margin-bottom: 10px; color: var(--text-muted);">Or join existing</p>
            <div style="display: flex; gap: 10px;">
                <input type="text" id="room-code" class="input-field" placeholder="Enter Room Code">
                <button id="join-btn" class="btn btn-primary">Join</button>
            </div>
        </div>
        <button id="logout-btn" class="btn"
            style="background: transparent; color: var(--text-muted); margin-top: 20px;">Logout</button>
    </div>

    <script type="module">
        import { auth, db } from './firebase.js';
        import { signOut } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js";
        import { doc, setDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";

        auth.onAuthStateChanged(u => {
            if (!u) window.location.href = 'auth.html';
            document.getElementById('user-display').innerText = u.email;
        });

        document.getElementById('logout-btn').onclick = () => signOut(auth);

        document.getElementById('create-btn').onclick = async () => {
            const roomId = Math.random().toString(36).substring(2, 8).toUpperCase(); // 6-char code
            await setDoc(doc(db, "rooms", roomId), {
                hostId: auth.currentUser.uid,
                videoId: "M7lc1UVf-VE", // Default video
                playerState: 2, // Paused
                currentTime: 0,
                lastUpdated: serverTimestamp()
            });
            window.location.href = `room.html?id=${roomId}`;
        };

        document.getElementById('join-btn').onclick = () => {
            const code = document.getElementById('room-code').value.trim().toUpperCase();
            if (code) window.location.href = `room.html?id=${code}`;
        };
    </script>
</body>

</html>
